on:
    push:
      branches:
      - master
      - main
    pull_request:
      branches:
      - master 
      - main
      
name: CI
  
jobs:
    lint:
      name: Lint and Test
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
          name: Checkout ğŸ›ï¸
        - uses: actions-rs/toolchain@v1
          name: Setup Cargo Toolchain ğŸ›ï¸
          with:
            components: rustfmt, clippy
            toolchain: stable
        - run: cargo test --all-features
          name: Running Tests ğŸš€
          working-directory: ./RayTracer
        - run: cargo fmt -- --check
          name: Check Code Format ğŸ”§
          working-directory: ./RayTracer
        - run: cargo clippy --all-targets --all-features -- -D warnings
          name: Lint with Clippy ğŸ”§
          working-directory: ./RayTracer
    build:
      name: Build and Upload
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
          name: Checkout ğŸ›ï¸
        - uses: actions-rs/toolchain@v1
          name: Setup Cargo Toolchain ğŸ›ï¸
          with:
            toolchain: stable
        - run: cargo build --release --all-features
          name: Build ğŸ”§
          working-directory: ./RayTracer
        - run: cargo run --release
          name: Run ğŸ”§
          working-directory: ./RayTracer
        - uses: actions/upload-artifact@v2
          name: Upload Artifacts ğŸš€
          with:
            name: output
            path: ./RayTracer/output/